---
id: f1559d49-83c6-451d-a1e5-91224ae726fa
title: 'Building PHP-GTK with Cairo Support on Ubuntu Jaunty'
excerpt: 'I successfully built PHP 5.3.0RC1 with PHP-GTK including Cairo support on Ubuntu Jaunty.'
author:
  - 58305525-d036-4657-bce6-1b7091fe031d
updated_by: 58305525-d036-4657-bce6-1b7091fe031d
updated_at: 1619572026
tags:
  - php
  - linux
---
[Elizabeth Smith](http://elizabethmariesmith.com/ "Dreaming of Dawn") managed to pique my interest and maintain the [patience of Job](http://en.wikipedia.org/wiki/Job_(Bible)#Job_in_Islam "Job (Bible) - Wikipedia, the free encyclopedia") long enough for me to successfully build [PHP 5.3.0RC1](http://qa.php.net/ "PHP-QAT: Quality Assurance Team") with [PHP-GTK](http://gtk.php.net/ "PHP-GTK") including [Cairo](http://cairographics.org/ "cairographics.org") support on [Ubuntu Jaunty](http://www.ubuntu.com/ "Ubuntu Home Page | Ubuntu"). The process was a bit arduous, as Ubuntu apparently has a rather "interesting" [`automake`](http://en.wikipedia.org/wiki/Automake "Automake - Wikipedia, the free encyclopedia") package, so I thought I'd document it here for anyone who might be interested in repeating the process.

I'm assuming here that you want to use as many available Ubuntu packages as is feasible, aside from maybe PHP itself, in order to minimize the amount of manual compilation necessary. To that end, there are a number packages you will need to install before getting started that do not come with a standard Jaunty installation.

```bash
sudo apt-get install subversion cvs libcairo2-dev libgtk2.0-dev
```

If you plan to build PHP from source, you will also need a few more packages.

```bash
sudo apt-get install build-essential autoconf libxml2-dev
```

Once you've got all the dependencies installed, the first step will be to grab a copy of PHP. You've got a few options in that regard.

* Install the stock [php5-cli](http://packages.ubuntu.com/jaunty/php5-cli "Ubuntu -- Details of package php5-cli in jaunty") and [php5-dev](http://packages.ubuntu.com/jaunty/php5-dev "Ubuntu -- Details of package php5-dev in jaunty") packages available for Ubuntu.
* Download a copy of [5.2.9](http://www.php.net/downloads.php "PHP: Downloads") or, if you want the new shiny stuff, [5.3.0RC1](http://qa.php.net/ "PHP-QAT: Quality Assurance Team").
* Download a [current snapshot](http://snaps.php.net/ "PHP Sources Snapshots") of the 5.2 or 5.3 branches.

Assuming you do a custom build, here's how I did it.

```bash
./configure \
    --with-gettext \
    --disable-cgi \
    --without-pear \
    --prefix=`pwd`/build/php_build

make

make install
```

Next, use Subversion to check out a copy of Cairo extension. If you did a custom PHP build, you can just place it on the same directory level as that.

```bash
svn co svn://whisky.macvicar.net/php-cairo cairo
```

At the present moment, the easiest way to install the Cairo extension is manually as a PECL extension. So, compile using the `phpize` utility in your PHP build.

```bash
cd cairo

../php-5.3.0RC1/build/php_build/bin/phpize

./configure \
    --prefix=`pwd`/build/php_build \
    --with-php-config=../php-5.3.0RC1/build/php_build/bin/php-config
```

It's at this point that Ubuntu's "interesting" automake package comes into play. The `Makefile` generated by `phpize` will be missing a critical flag `-DCOMPILE_DL_CAIRO` in its `CFLAGS` setting value. Open the `Makefile` in any text editor and find the line that looks like this.

```makefile
CFLAGS = -g -O2
```

Append the missing flag to the line so it looks like this, then save it.

```makefile
CFLAGS = -g -O2 -DCOMPILE_DL_CAIRO
```

At that point, just continue the compilation process for the Cairo extension as normal.

```bash
make

make install
```

Now use CVS to check out a copy of the PHP-GTK extension. Place it on the same directory level as Cairo.

```bash
export CVSROOT=:pserver:cvsread@cvs.php.net:/repository

cvs -q checkout -P php-gtk
```

If the `phpize` utility is not in your `PATH`, you'll have to assign it to an environmental variable as those are the only two ways that the `buildconf` utility you're about to use will pick it up.

```bash
export PHPIZE=../php-5.3.0RC1/build/php_build/bin/phpize
```

Execute the `buildconf` utility to generate the `configure` script, then execute it.

```bash
./buildconf

./configure \
    --prefix=`pwd`/build/php_build \
    --with-php-config=../php-5.3.0RC1/build/php_build/bin/php-config
```

To have the PHP-GTK extension take advantage of the presence of the Cairo extension, you'll need to add a flag to the `CFLAGS` setting in its `Makefile`. Open that, find the line that looks exactly like the original one modified in the Cairo `Makefile`, and append the flag `-DHAVE_CAIRO` to it so it looks like this.

```makefile
CFLAGS = -g -O2 -DHAVE_CAIRO
```

At that point, continue the compilation process normally just as with the Cairo extension. Once that's done, since the extensions were compiled as PECL extensions, you'll need to enable them in your `php.ini` file.

If you did a custom build of PHP, just copy the `php.ini-development` file in the root of the extracted tarball directory to `lib/php.ini` within your build directory as this is where PHP will look for it by default. If you're using PHP 5.3.0RC1, there is a syntax error around line 581 of that file. A URL should be commented out using a semicolon but isn't. Note that the `extension_dir` setting needs to be set and, if you use a relative path, it must be relative to the current working directory from which PHP is invoked (the root PHP build directory in my case).

```ini
extension_dir = "lib/php/extensions/no-debug-non-zts-20090115"
extension = cairo.so
extension = php_gtk2.so
```

At this point, if you execute your php binary with the `-m` switch, you should get a list of extensions loaded. `cairo` and `php-gtk` should be among them and you shouldn't see any errors before the extension listing. To take this for a test spin, there's a particular demo file for PHP-GTK with Cairo support in the php-gtk checkout.

```bash
cd php-5.3.0RC1/build/php_build

bin/php php-gtk/demos/examples/cairo_support.php
```

If this works as expected, you should see a nifty little PHP-powered clock widget on your desktop.

Many thanks to Elizabeth for her help in putting this tutorial together and for all the very cool people working on the PHP-GTK project. You can find them in the `#php-gtk` channel on the Freenode IRC network. At the present time, some of them are in the process of revamping the [PHP-GTK docs](http://gtk.php.net/docs.php "PHP-GTK : Documentation"). In the meantime, you can check out the [GTK docs](http://www.gtk.org/documentation.html "GTK+ - Documentation") for more current information.